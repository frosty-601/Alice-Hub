local player = game.Players.LocalPlayer
local playerGui = player.PlayerGui
local hotbar = playerGui:FindFirstChild("Hotbar")
local backpack = hotbar:FindFirstChild("Backpack")
local hotbarFrame = backpack:FindFirstChild("Hotbar")

-- Update tool names
local function updateToolName(slot, name)
    local baseButton = hotbarFrame:FindFirstChild(tostring(slot)).Base
    local ToolName = baseButton.ToolName
    ToolName.Text = name
end

updateToolName(1, "Compacted punch")
updateToolName(2, "Sky piercer")
updateToolName(3, "Whirlwind Throw")
updateToolName(4, "Barrage")

-- Set text in MagicHealth frame
local function findGuiAndSetText()
    local screenGui = playerGui:FindFirstChild("ScreenGui")
    if screenGui then
        local magicHealthFrame = screenGui:FindFirstChild("MagicHealth")
        if magicHealthFrame then
            local textLabel = magicHealthFrame:FindFirstChild("TextLabel")
            if textLabel then
                textLabel.Text = "COSMIC OVERLOAD"
            end
        end
    end
end

playerGui.DescendantAdded:Connect(findGuiAndSetText)
findGuiAndSetText()

-- Animation handling
local function handleAnimation(animationId, replacementId, startTime, speed)
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")

    local function onAnimationPlayed(animationTrack)
        if animationTrack.Animation.AnimationId == "rbxassetid://" .. animationId then
            for _, animTrack in pairs(humanoid:GetPlayingAnimationTracks()) do
                animTrack:Stop()
            end

            local AnimAnim = Instance.new("Animation")
            AnimAnim.AnimationId = "rbxassetid://" .. replacementId
            local Anim = humanoid:LoadAnimation(AnimAnim)
            Anim:Play()
            Anim:AdjustSpeed(0)
            Anim.TimePosition = startTime
            Anim:AdjustSpeed(speed)
        end
    end

    humanoid.AnimationPlayed:Connect(onAnimationPlayed)
end

-- Define all animations
handleAnimation(12273188754, 10468665991, 0, 0.5)
handleAnimation(12296113986, 17466449380, 0, 4)
handleAnimation(12309835105, 13376869471, 0, 0.8)
handleAnimation(13603396939, 13633468484, 0, 2)
handleAnimation(11343318134, 12983333733, 2, 0.5)
handleAnimation(15955393872, 15943915877, 0.05, 1)
handleAnimation(12983333733, 13073745835, 0, 0.2)
handleAnimation(12447707844, 18435303746, 0, 1)
handleAnimation(10479335397, 17838006839, 0, 0.7)
handleAnimation(10503381238, 14900168720, 1.3, 0.7)
handleAnimation(10470104242, 12447247483, 0, 6)
handleAnimation(12342141464, 13071982935, 0, 1)
handleAnimation(17859015788, 12684185971, 0, 1)
handleAnimation(10469643643, 17889290569, 0, 1)
handleAnimation(10469639222, 17889471098, 0, 1)
handleAnimation(10469630950, 17889461810, 0, 1)
handleAnimation(10469493270, 17889458563, 0, 1)
handleAnimation(11365563255, 14516273501, 0, 1)

-- Custom body velocity handling
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local function onBodyVelocityAdded(bodyVelocity)
    if bodyVelocity:IsA("BodyVelocity") then
        bodyVelocity.Velocity = Vector3.new(bodyVelocity.Velocity.X, 0, bodyVelocity.Velocity.Z)
    end
end

character.DescendantAdded:Connect(onBodyVelocityAdded)
for _, descendant in pairs(character:GetDescendants()) do
    onBodyVelocityAdded(descendant)
end

player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    character.DescendantAdded:Connect(onBodyVelocityAdded)
    for _, descendant in pairs(character:GetDescendants()) do
        onBodyVelocityAdded(descendant)
    end
end)

-- Specific teleportation logic for the "Sky piercer" move
local teleportAnimationId = 12296113986

local function onAnimationPlayed(animationTrack)
    if animationTrack.Animation.AnimationId == "rbxassetid://" .. teleportAnimationId then
        character.HumanoidRootPart.CFrame = character.HumanoidRootPart.CFrame * CFrame.new(0, 400, -3)
    end
end

local humanoid = character:WaitForChild("Humanoid")
humanoid.AnimationPlayed:Connect(onAnimationPlayed)
